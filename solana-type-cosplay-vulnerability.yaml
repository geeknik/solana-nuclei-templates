id: solana-type-cosplay-vulnerability

info:
  name: Solana Type Cosplay Vulnerability
  author: geeknik
  severity: high
  description: |
    Detects when a program uses shared data structures without discriminators, allowing one account type to impersonate another.
  remediation: |
    Add discriminators to all account structures and verify them before processing: `if account.discriminant != AccountDiscriminant::Expected { return Err(ProgramError::InvalidAccountData); }`
  reference:
    - https://github.com/slowmist/solana-smart-contract-security-best-practices
  metadata:
    verified: true
  tags: audit,solana,smart-contract,type-safety,discriminator

file:
  - extensions:
      - rs

    matchers:
      - type: regex
        regex:
          - "#\\[derive\\(BorshSerialize,\\s*BorshDeserialize"
      - type: regex
        regex:
          - "discriminant|discriminator"
          - "enum\\s+Account(Type|Discriminant)"
        negative: true
        condition: or
